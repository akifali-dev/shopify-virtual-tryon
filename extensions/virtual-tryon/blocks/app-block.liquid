{% if request.page_type == 'product' %}
  {% assign current_product = product %}
{% endif %}

{% if current_product.metafields.custom.tryon_image != blank %}
  {% assign product_image = current_product.metafields.custom.tryon_image | image_url: width: 2048 | prepend: 'https:' %}
{% else %}
  {% assign product_image = current_product.media.first.preview_image | image_url: width: 2048 | prepend: 'https:' %}
{% endif %}

{% render 'tryon-button',
  section_id: section.id,
  product_id: current_product.id,
  product_name: current_product.title,
  product_image: product_image,
  button_label: block.settings.button_label,
  font_size: block.settings.font_size,
  padding: block.settings.padding,
  margin: block.settings.margin,
  button_bg_color: block.settings.button_bg_color,
  button_text_color: block.settings.button_text_color,
  font_style: block.settings.font_style,
  border_radius: block.settings.border_radius,
  button_bg_gradient: block.settings.button_bg_gradient
%}

<div
  id="tryon-root"
  data-product-id="{{ current_product.id }}"
  data-product-name="{{ current_product.title }}"
  data-product-image="{{ product_image }}"
  data-app-url="{{ block.settings.app_url | default: '/apps/virtual-tryon' }}"
>
  <div id="tryon-app"></div>
</div>

<link rel="stylesheet" href="{{ 'main.css' | asset_url }}">


{% schema %}
{
  "name": "Virtual Try-On",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "button_label",
      "label": "Button label",
      "default": "Try On"
    },
    {
      "type": "text",
      "id": "font_size",
      "label": "Font size",
      "default": "16px"
    },
    {
      "type": "text",
      "id": "padding",
      "label": "Padding",
      "default": "10px 20px"
    },
    {
      "type": "text",
      "id": "margin",
      "label": "Margin",
      "default": "0"
    },
    {
      "type": "color",
      "id": "button_bg_color",
      "label": "Button background color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text color",
      "default": "#ffffff"
    },
    {
      "type": "text",
      "id": "font_style",
      "label": "Font style",
      "default": "normal"
    },
    {
      "type": "text",
      "id": "border_radius",
      "label": "Border radius",
      "default": "4px"
    },
    {
      "type": "color_background",
      "id": "button_bg_gradient",
      "label": "Button background gradient"
    }
  ]
}
{% endschema %}
